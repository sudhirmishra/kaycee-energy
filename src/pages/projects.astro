---
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/container.astro";
import Hero from "@/components/hero.astro";
import projectsData from "@/content/projects.json";

// Process projects to include imported image sources
const projectsToRender = await Promise.all(
  projectsData.map(async (project) => {
    let importedImageSrc = null;
    if (project.image_filename) {
      try {
        // Assuming image_filename is just the file name like "substation.jpg"
        // And images are in src/assets/services/
        const imageModule = await import(`../assets/services/${project.image_filename}`);
        importedImageSrc = imageModule.default.src; // Get the .src property from the imported image module
      } catch (e) {
        console.error(`Failed to import image: src/assets/services/${project.image_filename}`, e);
        // Optionally, set a placeholder image source here if import fails
      }
    }
    return {
      ...project,
      importedImageSrc: importedImageSrc,
    };
  })
);
---

<Layout title="Projects">
  <Hero title="Projects" />
  <Container>
    <!-- Breadcrumb Section -->
    <div class="mt-4">
      <nav aria-label="breadcrumb">
        <ol class="flex space-x-2 text-gray-600">
          <li><a href="/" class="hover:underline">Home</a></li>
          <li>/</li>
          <li>Projects</li>
        </ol>
      </nav>
    </div>

    <h1 class="text-center text-3xl font-bold my-6">Our Projects</h1>
    {/* Removed client-side selectedProject logic and detail view */}
    {/* Statically render all projects */}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {projectsToRender.map((project) => (
        <div class="p-4 border rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col">
          {project.importedImageSrc && (
            <div class="relative w-full h-48 overflow-hidden mb-4 rounded">
              <img
                src={project.importedImageSrc}
                alt={project.title}
                class="w-full h-full object-cover object-top"
              />
            </div>
          )}
          <div class="flex flex-col flex-grow">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">{project.title}</h3>
            {project.category && (
              <p class="text-sm text-blue-500 mb-2">{project.category}</p>
            )}
            <p class="text-gray-600 text-sm leading-relaxed flex-grow mb-4">{project.description}</p>
            {project.url && (
              <div class="mt-auto text-center">
                <a
                  href={project.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-block px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors duration-300"
                >
                  Read More
                </a>
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  </Container>
</Layout>
